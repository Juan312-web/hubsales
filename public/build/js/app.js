function initApp(){handleMenu(),handleSelectedLink(),handleSearchView(),handleSearch(),searchModalInvoices(),setDateExp(),setProducts(),saveInvoice()}function handleMenu(){const e=document.getElementById("menubar"),t=document.getElementById("menuclose"),a=document.getElementById("sidebar"),n=document.querySelector("#views__search");e&&e.addEventListener("click",()=>{a.classList.add("active"),n.classList.contains("active__search")&&(n.classList.remove("active__search"),n.classList.add("hide__search"))}),t&&t.addEventListener("click",()=>{a.classList.remove("active"),n.classList.remove("hide__search")})}function handleSelectedLink(){const e=document.querySelectorAll(".sidebar__link");e&&e.forEach(e=>{let t=window.location.href.split("/")[3];e.attributes.href.value.split("/")[1]!==t||e.classList.add("selected")})}function handleSearchView(){const e=document.querySelector("#views__search"),t=document.querySelector(".search__button");t&&t.addEventListener("click",t=>{t.preventDefault(),e.classList.remove("hidde__search"),e.classList.toggle("active__search")})}function handleSearch(){document.querySelectorAll(".views__input").forEach(e=>{e.addEventListener("input",t=>{t.preventDefault();let a=e.getAttribute("data-id").split("__")[1],n=e.getAttribute("data-search");handleSearchDinamic(a,t.target.value,n)})})}async function handleSearchDinamic(e,t,a){const n=document.querySelector(`.${e}__table`).querySelectorAll("tr#row");if(!t)return void n.forEach(e=>{e.style.display=""});let d=await searchBD(e,t);n.forEach(async e=>{const t=parseInt(e.getAttribute("data-row")),n=await d.some(e=>e[a]==t);e.style.display=n?"":"none"})}async function searchBD(e,t){try{const a=`http://localhost:3000/api/${e}?value=${t}`,n=await fetch(a);return await n.json()}catch(e){console.log(e)}}async function searchModalInvoices(){let e=document.querySelectorAll('[data-id="addInvoiceElement"]');e&&e.forEach(e=>{const t=e.dataset.title;e.addEventListener("click",e=>{e.preventDefault();const a=e.target.id.split("__")[1];pushModal(t,a)})})}function pushModal(e,t){const a=document.getElementById("search_label"),n=document.getElementById("modal"),d=document.getElementById("modal__icon");document.getElementById("modal__title").textContent="Select "+e,a.textContent=e.toLowerCase(),n&&!n.classList.contains("activ e")&&n.classList.add("active"),d.addEventListener("click",closeModal),setModal(t)}function closeModal(e){const t=document.querySelector(".invoice__table__body"),a=document.getElementById("modal"),n=document.getElementById("search__modal");a.classList.remove("active"),n.value="",t.innerHTML=""}function setModal(e){const t=document.getElementById("invoices__table"),a=document.querySelector(".invoice__table__base"),n=document.querySelector(".invoice__table__head"),d=document.querySelector(".invoice__table__body"),c=document.querySelector("#search__modal");let i="";n.innerHTML="";let o=[];"customer"===e?(o=["Name","Identity","Actions"],c.setAttribute("data-id","customers"),c.setAttribute("data-search","cli_identity"),c.setAttribute("placeholder","search by identity"),i="customers"):"user"===e?(o=["Name","Email","Actions"],c.setAttribute("data-id","users"),c.setAttribute("data-search","user_id"),c.setAttribute("placeholder","search by email"),i="users"):"product"===e&&(o=["Name","Max Quantity","Price","Actions"],c.setAttribute("data-id","products"),c.setAttribute("data-search","prod_id"),c.setAttribute("placeholder","search by Code"),i="products"),o&&o.forEach(e=>{const t=document.createElement("TH");t.textContent=e,n.appendChild(t)}),c.addEventListener("input",async e=>{let t=e.target.value;const a=await searchBD(c.getAttribute("data-id"),t);d.innerHTML="",""!==t&&a.forEach(e=>{if("customers"===i){const t=document.createElement("TR"),a=document.createElement("TD"),n=document.createElement("TD"),c=document.createElement("TD");a.setAttribute("data-label","Name"),a.textContent=`${e.cli_name} ${e.cli_lastname} `,n.setAttribute("data-label","Identity"),n.textContent=e.cli_identity;const i=document.createElement("A");i.classList.add("boton--action"),i.classList.add("update"),i.setAttribute("data-id",e.cli_id),i.addEventListener("click",()=>{});const o=document.createElement("SPAN");o.textContent="add",o.classList.add("material-symbols-outlined"),i.appendChild(o),i.addEventListener("click",t=>{t.preventDefault();const a=document.getElementById("cli_name");invoice.customer=e.cli_id,a.value=`${e.cli_name} ${e.cli_lastname} `,closeModal()}),c.classList.add("action__container"),c.appendChild(i),t.appendChild(a),t.appendChild(n),t.appendChild(c),d.appendChild(t)}else if("users"===i){const t=document.createElement("TR"),a=document.createElement("TD"),n=document.createElement("TD"),c=document.createElement("TD");a.setAttribute("data-label","Name"),a.textContent=`${e.user_name} ${e.user_lastname} `,n.setAttribute("data-label","Email"),n.textContent=e.user_email;const i=document.createElement("A");i.classList.add("boton--action"),i.classList.add("update"),i.setAttribute("data-id",e.user_id),i.addEventListener("click",()=>{});const o=document.createElement("SPAN");o.textContent="add",o.classList.add("material-symbols-outlined"),i.appendChild(o),i.addEventListener("click",t=>{t.preventDefault();const a=document.getElementById("user_name");invoice.user=e.user_id,a.value=`${e.user_name} ${e.user_lastname} `,closeModal()}),c.classList.add("action__container"),c.appendChild(i),t.appendChild(a),t.appendChild(n),t.appendChild(c),d.appendChild(t)}else if("products"===i){const t=document.createElement("TR"),a=document.createElement("TD"),n=document.createElement("TD"),c=document.createElement("INPUT"),i=document.createElement("TD"),o=document.createElement("TD");a.setAttribute("data-label","Name"),a.textContent=e.prod_name,n.setAttribute("data-label","Max-Quantity"),n.textContent=e.prod_stock+" U",c.setAttribute("type","number"),c.classList.add("modal__input__invoice"),c.max=e.prod_stock,c.addEventListener("input",()=>{c.value>e.prod_stock&&(c.value="")}),i.setAttribute("data-label","Price"),i.textContent="$"+e.prod_u_price;const s=document.createElement("A");s.classList.add("boton--action"),s.classList.add("update"),s.setAttribute("data-id",e.prod_id);const l=document.createElement("SPAN");l.textContent="add",l.classList.add("material-symbols-outlined"),s.appendChild(l),s.addEventListener("click",t=>{const{products:a}=invoice;if(0===a.length)invoice.products=[...invoice.products,{...e,quan:1}];else{invoice.products.find(t=>t.prod_id===e.prod_id)||(invoice.products=[...invoice.products,{...e,quan:1}])}closeModal(),setProducts()}),o.classList.add("action__container"),o.appendChild(s),t.appendChild(a),t.appendChild(n),t.appendChild(i),t.appendChild(o),d.appendChild(t)}})}),a.appendChild(n),a.appendChild(d),t.appendChild(a)}function setDate(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function setDateExp(){const e=document.getElementById("inv_date_exp");e&&e.addEventListener("change",t=>{invoice.date_exp=e.value})}function setProducts(){let{products:e}=invoice;const t=document.getElementById("invoices_products_table");t&&(t.innerHTML=""),e&&e.forEach(e=>{const a=document.createElement("TR"),n=document.createElement("TD"),d=document.createElement("TD"),c=document.createElement("TD"),i=document.createElement("INPUT"),o=document.createElement("TD"),s=document.createElement("TD");n.setAttribute("data-label","Name"),n.textContent=e.prod_name,d.setAttribute("data-label","Max-Quantity"),d.textContent=e.prod_stock+" U",c.appendChild(i),c.setAttribute("data-label","Quantity"),i.setAttribute("type","number"),i.classList.add("modal__input__invoice"),i.max=e.prod_stock,i.value=e.quan,i.addEventListener("change",()=>{i.value>e.prod_stock||i.value<=0?i.value=1:invoice.products.forEach(t=>{t.prod_id===e.prod_id&&(t.quan=i.value)})}),o.setAttribute("data-label","Price"),o.textContent="$"+e.prod_u_price;const l=document.createElement("A");l.classList.add("boton--action"),l.classList.add("delete"),l.setAttribute("data-id",e.prod_id);const r=document.createElement("SPAN");r.textContent="delete",r.classList.add("material-symbols-outlined"),l.appendChild(r),l.addEventListener("click",e=>{const{products:t}=invoice;let a=parseInt(l.getAttribute("data-id"));invoice.products=t.filter(e=>e.prod_id!==a),setProducts()}),s.classList.add("action__container"),s.appendChild(l),a.appendChild(n),a.appendChild(d),a.appendChild(c),a.appendChild(o),a.appendChild(s),t.appendChild(a)})}function saveInvoice(){let e=document.querySelector(".form__invoice");e&&e.addEventListener("submit",async e=>{e.preventDefault();try{let e="http://localhost:3000/invoices-add",t=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(invoice)}),a=await t.json();if(a.alertas){let e=a.alertas.error;const t=document.getElementById("alertContainer");t.innerHTML="",e.forEach(e=>{const a=`\n            <div id="alertas__container" class="alertas__container error zindex ">\n              <span class="material-symbols-outlined alertas__icon">\n                error\n              </span>\n              <p class="alertas__message">\n              ${e}\n              </p>\n            </div>`;t.innerHTML+=a}),setTimeout(()=>{t&&(t.innerHTML="")},3500)}else window.location.href="http://localhost:3000/invoices"}catch(e){console.log(e)}})}document.addEventListener("DOMContentLoaded",(function(){initApp()})),invoice={customer:"",user:"",date:setDate(),date_exp:"",products:[]};